---
layout: post
title:  "SPI: El Protocolo de Comunicaci√≥n R√°pida para IoT"
date:   2025-08-15 17:00:00 +0000
categories: [electronica, fundamentos]
tags: ["spi", "protocolo", "comunicaci√≥n", "esp32", "iot", "serial"]
image:
  path: ../../assets/img/posts/prototipo/spi.png
  alt: Comunicaci√≥n SPI entre dispositivos
description: "Gu√≠a completa sobre el protocolo SPI: qu√© es, c√≥mo funciona, conexiones, ventajas en IoT y ejemplos pr√°cticos con ESP32. Ideal para sensores, pantallas y m√≥dulos RF de alta velocidad."
---

# SPI: El Protocolo de Comunicaci√≥n R√°pida para IoT

## üöÄ ¬øQu√© es SPI?

**SPI (Serial Peripheral Interface)** es un protocolo de comunicaci√≥n **s√≠ncrona** desarrollado por Motorola que permite la comunicaci√≥n de alta velocidad entre microcontroladores y perif√©ricos. A diferencia de I2C o UART, SPI est√° dise√±ado para **velocidad** y es ideal para sensores, pantallas, memorias y m√≥dulos RF en proyectos IoT.

---

## üìå Caracter√≠sticas principales

- **Comunicaci√≥n full-duplex** (datos simult√°neos en ambas direcciones)
- **Velocidades muy altas** (hasta varios MHz)
- **Protocolo maestro-esclavo** con un dispositivo maestro controlando m√∫ltiples esclavos
- **4 l√≠neas de comunicaci√≥n** (MOSI, MISO, SCK, CS/SS)

---

## üîå Pines y conexiones

SPI utiliza **4 l√≠neas principales**:

- **MOSI** (Master Out Slave In): Datos del maestro al esclavo
- **MISO** (Master In Slave Out): Datos del esclavo al maestro  
- **SCK** (Serial Clock): Se√±al de reloj generada por el maestro
- **CS/SS** (Chip Select/Slave Select): Selecci√≥n de dispositivo esclavo

```
Maestro (ESP32)    ‚Üí    Esclavo (Sensor)
MOSI (Pin 23)      ‚Üí    MOSI/DIN
MISO (Pin 19)      ‚Üê    MISO/DOUT
SCK  (Pin 18)      ‚Üí    SCK/CLK
CS   (Pin 5)       ‚Üí    CS/SS
```

---

## ‚ö° Ventajas de SPI en IoT

1. **Alta velocidad**: Ideal para pantallas, c√°maras y sensores de alta frecuencia
2. **Full-duplex**: Env√≠o y recepci√≥n simult√°nea de datos
3. **Simple implementaci√≥n**: Sin direccionamiento complejo como I2C
4. **Bajo overhead**: Sin bits de start/stop como UART

---

## üõ†Ô∏è Dispositivos comunes que usan SPI

- **Pantallas**: TFT, OLED, E-Paper
- **Memorias**: EEPROM, Flash, tarjetas SD
- **Sensores**: Aceler√≥metros, giroscopios, bar√≥metros
- **M√≥dulos RF**: NRF24L01, LoRa SX1278
- **Convertidores**: ADC/DAC externos

---

## üíª Ejemplo pr√°ctico: ESP32 + Sensor MPU6050

```cpp
#include <SPI.h>

#define CS_PIN 5

void setup() {
  Serial.begin(115200);
  SPI.begin();
  pinMode(CS_PIN, OUTPUT);
  digitalWrite(CS_PIN, HIGH); // CS inactivo por defecto
}

void loop() {
  // Seleccionar dispositivo
  digitalWrite(CS_PIN, LOW);
  
  // Enviar comando para leer WHO_AM_I (0x75)
  SPI.transfer(0x75 | 0x80); // Bit 7 = 1 para lectura
  uint8_t whoami = SPI.transfer(0x00); // Leer respuesta
  
  // Deseleccionar dispositivo
  digitalWrite(CS_PIN, HIGH);
  
  Serial.print("WHO_AM_I: 0x");
  Serial.println(whoami, HEX);
  
  delay(1000);
}
```

---

## üîÑ Modos de SPI

SPI tiene **4 modos** definidos por la **polaridad** (CPOL) y **fase** (CPHA) del reloj:

| Modo | CPOL | CPHA | Descripci√≥n |
|------|------|------|-------------|
| 0    | 0    | 0    | Reloj bajo en reposo, datos en flanco ascendente |
| 1    | 0    | 1    | Reloj bajo en reposo, datos en flanco descendente |
| 2    | 1    | 0    | Reloj alto en reposo, datos en flanco descendente |
| 3    | 1    | 1    | Reloj alto en reposo, datos en flanco ascendente |

---

## üìä SPI vs otros protocolos

| Protocolo | Velocidad | Pines | Dispositivos | Complejidad |
|-----------|-----------|-------|--------------|-------------|
| **SPI**   | Muy alta  | 4+n   | M√∫ltiples    | Baja        |
| **I2C**   | Media     | 2     | M√∫ltiples    | Media       |
| **UART**  | Baja      | 2     | 1 a 1        | Muy baja    |

---

## üéØ Consejos para usar SPI en IoT

1. **Cables cortos**: SPI es sensible al ruido a altas velocidades
2. **Alimentaci√≥n estable**: Usa condensadores de desacoplo
3. **Pull-ups en CS**: Evita estados flotantes
4. **Documentaci√≥n**: Siempre revisa el datasheet del sensor
5. **Nivel l√≥gico**: Verifica compatibilidad 3.3V/5V

---

## üîß Configuraci√≥n avanzada en ESP32

```cpp
SPISettings settingsA(1000000, MSBFIRST, SPI_MODE0);

void readSensor() {
  SPI.beginTransaction(settingsA);
  digitalWrite(CS_PIN, LOW);
  
  // Tu c√≥digo aqu√≠
  
  digitalWrite(CS_PIN, HIGH);
  SPI.endTransaction();
}
```

---

## üö® Problemas comunes

1. **CS mal conectado**: Verifica las conexiones de Chip Select
2. **Modo SPI incorrecto**: Consulta el datasheet del dispositivo
3. **Velocidad muy alta**: Reduce la frecuencia del reloj
4. **Cables largos**: Mant√©n las conexiones cortas y blindadas

---

SPI es fundamental en IoT para aplicaciones que requieren **alta velocidad** y **bajo latency**. Su simplicidad y rendimiento lo convierten en la opci√≥n ideal para sensores cr√≠ticos, pantallas y almacenamiento en proyectos IoT profesionales.